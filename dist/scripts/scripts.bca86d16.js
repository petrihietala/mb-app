"use strict";var app=angular.module("mb-app",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","ngStorage"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/items.html",controller:"ItemsCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]).constant("FIREBASE_URL","https://marketbasket.firebaseio.com");app.controller("ItemsCtrl",["$scope","ItemService","$localStorage",function(a,b,c){a.items=b.all,a.undoItemId=null,a.editItem=null,a.openedItemId=null,a.isEditModeEnabled=!1,a.orderVariable="",a.storage=c.$default({donehidden:!1,sortEnabled:!1}),a.hideDone=a.storage.donehidden,a.getItems=function(b){var c=a.items;return b&&(c=c.filter(function(a){return!a.done})),c},a.deleteItem=function(a){b["delete"](a)},a.confirmAdd=function(b){b.done&&(a.undoItemId=b.$id)},a.update=function(a){a.done?b.update(a):a.done=!0},a.cancelAdd=function(b){b.done=!0,a.undoItemId=null},a.addConfirmed=function(c){c.done=!1,c.date=new Date,a.undoItemId=null,b.update(c)},a.selectItem=function(c){null!=a.editItem&&a.editItem.$id!=c.$id&&b.update(a.editItem),a.editItem=null,a.openedItemId=a.openedItemId==c.$id?null:c.$id},a.$watch(function(){return a.storage.sortEnabled},function(b){a.orderVariable=b?["done",""]:""}),a.selectEditItem=function(c,d){c?a.editItem=d:(b.update(d),a.editItem=null)},a.$watch(function(){return b.isEditModeEnabled},function(c){a.isEditModeEnabled=c,0==a.isEditModeEnabled&&a.items.forEach(function(a){b.update(a)})})}]),app.factory("ItemService",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b),d=a(c.child("items")).$asArray(),e=null,f=!0,g={all:d,create:function(a){var b=d;return""!=a.title&&(b=d.$add(a)),b},get:function(b){return a(c.child("items").child(b)).$asObject()},"delete":function(a){return d.$remove(a)},update:function(a){return d.$save(a)},removeDone:function(){var a=d.filter(function(a){return a.done});$.each(a,function(){g["delete"](this)})},setSelectedItem:function(a){e=a},selectedItem:e,isEditModeEnabled:f,setEditMode:function(a){f=a}};return g}]),app.controller("NavCtrl",["$scope","$location","ItemService","$localStorage",function(a,b,c,d){a.item={title:"",done:!1},a.isEditModeEnabled=!1,a.storage=d.$default({donehidden:!1}),a.storage=d.$default({sortEnabled:!1}),a.addItem=function(){a.item.date=Date.now(),c.create(a.item).then(function(c){b.path("/items/"+c.name()),a.item={title:"",done:!1}})},a.removeDone=function(){c.removeDone()},a.$watch(function(){return a.isEditModeEnabled},function(a){c.isEditModeEnabled=a})}]);